"use strict";(globalThis.webpackChunkserenity_users_guide=globalThis.webpackChunkserenity_users_guide||[]).push([[8598],{1243(e,a,n){n.d(a,{A:()=>s});const s=n.p+"assets/images/calculator-step-screenshots-f155907793e985d481afe765cc342085.png"},2078(e,a,n){n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"guide/step_libraries","title":"Bibliotecas de Pasos","description":"En Serenity, las pruebas se dividen en pasos reutilizables. Un principio importante detr\xe1s de Serenity es la idea de que es m\xe1s f\xe1cil mantener una prueba que usa varias capas de abstracci\xf3n para ocultar la complejidad detr\xe1s de diferentes partes de una prueba.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/guide/steps.md","sourceDirName":"guide","slug":"/guide/step_libraries","permalink":"/es/docs/guide/step_libraries","draft":false,"unlisted":false,"editUrl":"https://github.com/serenity-bdd/serenity-bdd.github.io/blob/master/docs/guide/steps.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"step_libraries","title":"Bibliotecas de Pasos","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Usando Maven con Serenity","permalink":"/es/docs/guide/maven"},"next":{"title":"Interactuando con P\xe1ginas Web","permalink":"/es/docs/guide/page_objects"}}');var t=n(4848),i=n(8453);const r={id:"step_libraries",title:"Bibliotecas de Pasos",sidebar_position:4},o="Bibliotecas de Pasos de Serenity",l={},c=[{value:"Dividiendo las pruebas en pasos",id:"dividiendo-las-pruebas-en-pasos",level:2},{value:"Implementando Bibliotecas de Pasos Simples",id:"implementando-bibliotecas-de-pasos-simples",level:2},{value:"Clases de Interacci\xf3n de UI",id:"clases-de-interacci\xf3n-de-ui",level:3},{value:"Bibliotecas de Pasos de Persona",id:"bibliotecas-de-pasos-de-persona",level:3},{value:"Instancias Compartidas de Bibliotecas de Pasos",id:"instancias-compartidas-de-bibliotecas-de-pasos",level:2}];function d(e){const a={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.header,{children:(0,t.jsx)(a.h1,{id:"bibliotecas-de-pasos-de-serenity",children:"Bibliotecas de Pasos de Serenity"})}),"\n",(0,t.jsx)(a.p,{children:"En Serenity, las pruebas se dividen en pasos reutilizables. Un principio importante detr\xe1s de Serenity es la idea de que es m\xe1s f\xe1cil mantener una prueba que usa varias capas de abstracci\xf3n para ocultar la complejidad detr\xe1s de diferentes partes de una prueba."}),"\n",(0,t.jsx)(a.p,{children:"En una prueba de aceptaci\xf3n automatizada, los pasos de prueba representan el nivel de abstracci\xf3n entre el c\xf3digo que interact\xfaa con tu aplicaci\xf3n (por ejemplo, Page Component Object en una prueba web automatizada, que modelan partes de la interfaz de usuario, o endpoints de API para servicios web con los que necesitas interactuar) y las historias de nivel m\xe1s alto (secuencias de acciones m\xe1s enfocadas en el negocio que ilustran c\xf3mo se ha implementado una historia de usuario dada). Si tu prueba automatizada no est\xe1 orientada a la UI (por ejemplo, si llama a un servicio web), los pasos orquestan otros componentes m\xe1s t\xe9cnicos como clientes REST. Los pasos pueden contener otros pasos, y se incluyen en los reportes de Serenity. Cada vez que se ejecuta un paso de UI, se almacena una captura de pantalla y se muestra en el reporte."}),"\n",(0,t.jsx)(a.h2,{id:"dividiendo-las-pruebas-en-pasos",children:"Dividiendo las pruebas en pasos"}),"\n",(0,t.jsx)(a.p,{children:"Supongamos que estamos probando un programa de Viajero Frecuente, y necesitamos ilustrar las siguientes reglas de negocio:"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:"Los miembros deben comenzar con estado Bronze"}),"\n",(0,t.jsx)(a.li,{children:"Los miembros deben ganar estado Silver despu\xe9s de volar 10,000 km."}),"\n"]}),"\n",(0,t.jsx)(a.p,{children:"Cada una de estas puede dividirse a\xfan m\xe1s en tareas y verificaciones de negocio. Por ejemplo, la primera regla podr\xeda dividirse en dos pasos:"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:"Crear un nuevo miembro de Viajero Frecuente"}),"\n",(0,t.jsx)(a.li,{children:"Verificar que el miembro tiene un estado de Bronze"}),"\n"]}),"\n",(0,t.jsx)(a.p,{children:"Y la segunda puede dividirse en tres pasos:"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:"Crear un nuevo miembro de Viajero Frecuente"}),"\n",(0,t.jsx)(a.li,{children:"Hacer que el miembro vuele 10000 km"}),"\n",(0,t.jsx)(a.li,{children:"Verificar que el miembro tiene un estado de Silver"}),"\n"]}),"\n",(0,t.jsx)(a.p,{children:"Podr\xedamos expresar estas pruebas usando Serenity en JUnit 5 de la siguiente manera:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-java",children:"package flyer;\n\nimport net.serenitybdd.junit5.SerenityJUnit5Extension;\nimport net.thucydides.core.annotations.Steps;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport flyer.steps.TravellerEarningStatusPoints;\n\nimport static flyer.Status.Bronze;\nimport static flyer.Status.Silver;\n\n@ExtendWith(SerenityJUnit5Extension.class)\nclass WhenEarningFrequentFlyerPoints {\n\n    @Steps\n    TravellerEarningStatusPoints tracy;\n\n    @Test\n    void members_should_start_with_Bronze_status() {\n        // GIVEN\n        tracy.joins_the_frequent_flyer_program();\n\n        // THEN\n        tracy.should_have_a_status_of(Bronze);\n    }\n\n    @Test\n    void earn_silver_after_10000_kilometers() {\n        // GIVEN\n        tracy.joins_the_frequent_flyer_program();\n\n        // WHEN\n        tracy.flies(10000);\n\n        // THEN\n        tracy.should_have_a_status_of(Silver);\n    }\n}\n"})}),"\n",(0,t.jsx)(a.admonition,{title:"JUnit 4 Obsoleto",type:"note",children:(0,t.jsxs)(a.p,{children:["Si a\xfan est\xe1s usando JUnit 4 con ",(0,t.jsx)(a.code,{children:"@RunWith(SerenityRunner.class)"}),", ten en cuenta que el soporte de JUnit 4 est\xe1 obsoleto a partir de Serenity 5.0.0 y ser\xe1 eliminado en Serenity 6.0.0. Por favor migra a JUnit 5 usando ",(0,t.jsx)(a.code,{children:"@ExtendWith(SerenityJUnit5Extension.class)"})," como se muestra arriba."]})}),"\n",(0,t.jsx)(a.p,{children:"Observa c\xf3mo la segunda prueba reutiliza m\xe9todos de pasos usados en la primera para realizar una prueba ligeramente diferente. Este es un ejemplo t\xedpico de la manera en que reutilizamos pasos en pruebas similares, para evitar c\xf3digo duplicado y hacer el c\xf3digo m\xe1s f\xe1cil de mantener."}),"\n",(0,t.jsx)(a.h2,{id:"implementando-bibliotecas-de-pasos-simples",children:"Implementando Bibliotecas de Pasos Simples"}),"\n",(0,t.jsxs)(a.p,{children:["La clase ",(0,t.jsx)(a.code,{children:"TravellerEarningStatusPoints"})," es lo que llamamos una biblioteca de pasos. Usamos la clase ",(0,t.jsx)(a.code,{children:"@Steps"})," como se muestra arriba para indicar una biblioteca de pasos en nuestro c\xf3digo de prueba: esta anotaci\xf3n le dice a Serenity que instancie e instrumente este campo, para que los m\xe9todos que llames en esta biblioteca tambi\xe9n aparezcan en los reportes de prueba."]}),"\n",(0,t.jsx)(a.p,{children:"Las bibliotecas de pasos contienen las tareas de negocio o acciones que un usuario realiza durante una prueba. Hay muchas formas de organizar tus bibliotecas de pasos, pero una forma conveniente es agrupar m\xe9todos en porciones de comportamiento de negocio para un tipo dado de usuario. En este caso un viajero que est\xe1 ganando puntos de estado."}),"\n",(0,t.jsxs)(a.p,{children:["Observa que no fue necesario instanciar expl\xedcitamente la clase de pasos ",(0,t.jsx)(a.code,{children:"TravellerEarningStatusPoints"}),". Cuando anotas una variable miembro de esta clase con la anotaci\xf3n ",(0,t.jsx)(a.code,{children:"@Steps"}),", Serenity BDD la instanciar\xe1 autom\xe1ticamente por ti."]}),"\n",(0,t.jsxs)(a.p,{children:["Nunca debes crear instancias de bibliotecas de pasos usando la palabra clave ",(0,t.jsx)(a.code,{children:"new"}),", ya que Serenity no podr\xe1 instrumentar la biblioteca de pasos correctamente, y los m\xe9todos llamados no aparecer\xe1n en los reportes."]}),"\n",(0,t.jsxs)(a.p,{children:["Por ejemplo, supongamos que queremos probar una UI de calculadora simple. En esta clase, usamos la biblioteca de pasos ",(0,t.jsx)(a.code,{children:"CalculatorSteps"}),", que anotamos con la anotaci\xf3n ",(0,t.jsx)(a.code,{children:"@Steps"}),":"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-java",children:'@ExtendWith(SerenityJUnit5Extension.class)\nclass WhenDoingSums {\n\n    @Steps\n    CalculatorSteps calulate;\n\n    @Nested\n    class ABasicCalculator {\n\n        @BeforeEach\n        void openTheCalculator() {\n            calulate.openTheCalculatorApp();\n        }\n\n        @Test\n        void shouldCalculateAdditions() {\n            int result = calulate.theAnswerTo("1","+","2");\n            assertThat(result).isEqualTo(3);\n        }\n\n        @Test\n        void shouldCalculateSubtractions() {\n            int result = calulate.theAnswerTo("7","-","3");\n            assertThat(result).isEqualTo(4);\n        }\n\n        @Test\n        void shouldCalculateMultiplications() {\n            int result = calulate.theAnswerTo("3","*","2");\n            assertThat(result).isEqualTo(6);\n        }\n\n        @Test\n        void shouldCalculateDivisions() {\n            int result = calulate.theAnswerTo("10","/","2");\n            assertThat(result).isEqualTo(5);\n        }\n    }\n}\n'})}),"\n",(0,t.jsxs)(a.p,{children:["La clase ",(0,t.jsx)(a.code,{children:"CalculatorSteps"})," define los pasos que un usuario necesita realizar - en este caso, realizar un c\xe1lculo en la aplicaci\xf3n de calculadora:"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-java",children:'public class CalculatorSteps {\n\n    @Step("Calculate the answer to {0} {1} {2}")\n    public int theAnswerTo(String a, String operator, String b) {\n        // Interactuar con la calculadora para realizar el c\xe1lculo\n    }\n}\n'})}),"\n",(0,t.jsxs)(a.p,{children:["Los m\xe9todos de paso est\xe1n anotados con la anotaci\xf3n ",(0,t.jsx)(a.code,{children:"@Step"}),", que le dice a Serenity que incluya este m\xe9todo en los reportes de prueba de Serenity. El valor que incluimos en la anotaci\xf3n ",(0,t.jsx)(a.code,{children:"@Step"})," es el texto que aparecer\xe1 en los reportes de Serenity cuando este paso se ejecute. Los n\xfameros entre llaves (",(0,t.jsx)(a.code,{children:"{0}"}),",",(0,t.jsx)(a.code,{children:"{1}"})," y ",(0,t.jsx)(a.code,{children:"{2}"}),") representan marcadores de posici\xf3n para los par\xe1metros del m\xe9todo, si queremos que aparezcan en los reportes."]}),"\n",(0,t.jsx)(a.p,{children:"Cuando ejecutamos este caso de prueba, Serenity documentar\xe1 los pasos que se ejecutan durante cada prueba, produciendo una documentaci\xf3n viva de la ejecuci\xf3n de la prueba:"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:n(5280).A+"",width:"3296",height:"2030"})}),"\n",(0,t.jsx)(a.h3,{id:"clases-de-interacci\xf3n-de-ui",children:"Clases de Interacci\xf3n de UI"}),"\n",(0,t.jsxs)(a.p,{children:["Supongamos que nuestra prueba de calculadora necesita interactuar con una UI web, como la de ",(0,t.jsx)(a.a,{href:"https://juliemr.github.io/protractor-demo/",children:"https://juliemr.github.io/protractor-demo/"})," mostrada aqu\xed:"]}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:n(5240).A+"",width:"2132",height:"706"})}),"\n",(0,t.jsxs)(a.p,{children:["Podemos acceder a la potente integraci\xf3n de Selenium de Serenity BDD en nuestras bibliotecas de pasos extendiendo la clase ",(0,t.jsx)(a.code,{children:"net.serenitybdd.core.steps.UIInteractions"}),". Una implementaci\xf3n muy simple podr\xeda verse as\xed:"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-java",children:'public class CalculatorSteps extends UIInteractions {\n\n     @Step\n    public void openTheCalculatorApp() {\n        openUrl("https://juliemr.github.io/protractor-demo/");\n    }\n\n   @Step("Calculate the answer to {0} {1} {2}")\n    public int theAnswerTo(String firstValue, String operator, String secondValue) {\n\n        $("[ng-model=first]").sendKeys(firstValue);\n        $("[ng-model=operator]").selectByVisibleText(operator);\n        $("[ng-model=second]").sendKeys(secondValue);\n        $("#gobutton").click();\n        waitForAngularRequestsToFinish();\n\n        return Integer.parseInt($("css:h2").getText());\n    }\n}\n'})}),"\n",(0,t.jsx)(a.p,{children:"Una implementaci\xf3n m\xe1s legible y refactorizada podr\xeda verse as\xed:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-java",children:'public class CalculatorSteps extends UIInteractions {\n\n    private static final By FIRST_VALUE_FIELD = By.cssSelector("[ng-model=first]");\n    private static final By SECOND_VALUE_FIELD = By.cssSelector("[ng-model=second]");\n    private static final By OPERATOR_DROPDOWN = By.cssSelector("[ng-model=operator]");\n    private static final By GO_BUTTON = By.id("gobutton");\n    private static final By RESULT_FIELD = By.tagName("h2");\n    private static final Pattern A_VALID_NUMBER = Pattern.compile("-?\\\\d\\\\.?d*");\n\n    @Step\n    public void openTheCalculatorApp() {\n        openUrl("https://juliemr.github.io/protractor-demo/");\n    }\n\n    @Step("Calculate the answer to {0} {1} {2}")\n    public int theAnswerTo(String firstValue, String operator, String secondValue) {\n\n        $(FIRST_VALUE_FIELD).sendKeys(firstValue);\n        $(OPERATOR_DROPDOWN).selectByVisibleText(operator);\n        $(SECOND_VALUE_FIELD).sendKeys(secondValue);\n        $(GO_BUTTON).click();\n        waitFor(ExpectedConditions.textMatches(RESULT_FIELD,A_VALID_NUMBER));\n\n        return Integer.parseInt($(RESULT_FIELD).getText());\n    }\n}\n'})}),"\n",(0,t.jsx)(a.p,{children:"Las pruebas ahora interactuar\xe1n con la interfaz de usuario, reportar\xe1n tanto los pasos ejecutados como (si est\xe1 configurado para hacerlo) grabar\xe1n capturas de pantalla para cada paso:"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:n(1243).A+"",width:"2202",height:"1488"})}),"\n",(0,t.jsx)(a.h3,{id:"bibliotecas-de-pasos-de-persona",children:"Bibliotecas de Pasos de Persona"}),"\n",(0,t.jsx)(a.p,{children:"Otro enfoque para modelar bibliotecas de pasos gira en torno a actores y roles. Volvamos a nuestro ejemplo original: Tracy, la viajera, que gana puntos cuando viaja."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-java",children:'public class TravellerEarningStatusPoints {\n\n    private String actor;\n\n    private FrequentFlyer frequentFlyer;\n\n    @Step("#actor joins the frequent flyer program")\n    public void joins_the_frequent_flyer_program() {\n        frequentFlyer = FrequentFlyer.withInitialBalanceOf(0);\n    }\n\n    @Step("#actor flies {0} km")\n    public void flies(int distance) {\n        frequentFlyer.recordFlightDistanceInKilometers(distance);\n    }\n\n    @Step("#actor should have a status of {0}")\n    public void should_have_a_status_of(Status expectedStatus) {\n        assertThat(frequentFlyer.getStatus()).isEqualTo(expectedStatus);\n    }\n\n    @Step("#actor transfers {0} points to {1}")\n    public void transfers_points(int points, TravellerEarningStatusPoints otherFrequentFlier) {\n        // Dejado como ejercicio\n    }\n\n    @Override\n    public String toString() {\n        return actor;\n    }\n\n    @Step("#actor should have {0} points")\n    public void should_have_points(int expectedPoints) {\n        // Dejado como ejercicio\n    }\n}\n'})}),"\n",(0,t.jsxs)(a.p,{children:["Este enfoque usa el concepto de bibliotecas de pasos de ",(0,t.jsx)(a.em,{children:"persona"}),", donde una biblioteca de pasos representa las acciones de un usuario espec\xedfico realizando una tarea espec\xedfica (Tracy la viajera que est\xe1 ganando puntos). En este caso, Serenity instanciar\xe1 autom\xe1ticamente el campo ",(0,t.jsx)(a.em,{children:"actor"})," con el nombre de la variable de la biblioteca de pasos (",(0,t.jsx)(a.code,{children:"tracy"}),"), permitiendo que aparezca en los reportes de prueba para hacerlos m\xe1s legibles:"]}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{src:n(5770).A+"",width:"2422",height:"1408"})}),"\n",(0,t.jsx)(a.h2,{id:"instancias-compartidas-de-bibliotecas-de-pasos",children:"Instancias Compartidas de Bibliotecas de Pasos"}),"\n",(0,t.jsx)(a.p,{children:"Hay algunos casos donde queremos reutilizar la misma instancia de biblioteca de pasos en diferentes lugares a trav\xe9s de una prueba. Por ejemplo, supongamos que tenemos una biblioteca de pasos que interact\xfaa con una API backend, y que mantiene alg\xfan estado interno y cach\xe9 para mejorar el rendimiento. Podr\xedamos querer reutilizar una sola instancia de esta biblioteca de pasos, en lugar de tener una instancia separada para cada variable."}),"\n",(0,t.jsx)(a.p,{children:"Podemos hacer esto declarando la biblioteca de pasos como compartida, as\xed:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-java",children:"@Steps(shared = true)\nCustomerAPIStepLibrary customerAPI;\n"})}),"\n",(0,t.jsxs)(a.p,{children:["Ahora, cualquier otra biblioteca de pasos de tipo ",(0,t.jsx)(a.code,{children:"CustomerAPIStepLibrary"}),", que tenga el atributo shared establecido a true se referir\xe1 a la misma instancia."]}),"\n",(0,t.jsx)(a.p,{children:"En versiones anteriores de Serenity, compartir instancias era el comportamiento por defecto, y usabas el atributo uniqueInstance para indicar que una biblioteca de pasos no deb\xeda ser compartida. Si necesitas forzar este comportamiento para suites de pruebas heredadas, establece la propiedad step.creation.strategy a legacy en tu archivo serenity.properties:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-javascript",children:"step.creation.strategy = legacy\n"})})]})}function u(e={}){const{wrapper:a}={...(0,i.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},5240(e,a,n){n.d(a,{A:()=>s});const s=n.p+"assets/images/calculator-app-15faebe39eed240aa4b761e9f492c763.png"},5280(e,a,n){n.d(a,{A:()=>s});const s=n.p+"assets/images/calculator-steps-5da4a36b105ab6c58ccc74f377dab106.png"},5770(e,a,n){n.d(a,{A:()=>s});const s=n.p+"assets/images/persona-steps-e3e5d126e535bceb61d05022b43ca6a7.png"},8453(e,a,n){n.d(a,{R:()=>r,x:()=>o});var s=n(6540);const t={},i=s.createContext(t);function r(e){const a=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(i.Provider,{value:a},e.children)}}}]);