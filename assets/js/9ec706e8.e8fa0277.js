"use strict";(globalThis.webpackChunkserenity_users_guide=globalThis.webpackChunkserenity_users_guide||[]).push([[4946],{7553(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"playwright/playwright_best_practices","title":"Best Practices","description":"This guide covers best practices for writing maintainable, reliable, and efficient Serenity Playwright tests.","source":"@site/docs/playwright/best-practices.md","sourceDirName":"playwright","slug":"/playwright/playwright_best_practices","permalink":"/docs/playwright/playwright_best_practices","draft":false,"unlisted":false,"editUrl":"https://github.com/serenity-bdd/serenity-bdd.github.io/blob/master/docs/playwright/best-practices.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"playwright_best_practices","title":"Best Practices","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Configuration","permalink":"/docs/playwright/playwright_configuration"},"next":{"title":"Tutorial: Testing TodoMVC","permalink":"/docs/playwright/playwright_tutorial_todomvc"}}');var r=s(4848),a=s(8453);const i={id:"playwright_best_practices",title:"Best Practices",sidebar_position:6},o="Best Practices",l={},c=[{value:"Test Architecture",id:"test-architecture",level:2},{value:"Follow the Three-Layer Pattern",id:"follow-the-three-layer-pattern",level:3},{value:"Keep Tests Focused",id:"keep-tests-focused",level:3},{value:"Browser Management",id:"browser-management",level:2},{value:"Share Browser, Isolate Pages",id:"share-browser-isolate-pages",level:3},{value:"Use Browser Contexts for Isolation",id:"use-browser-contexts-for-isolation",level:3},{value:"Extract Common Setup into a Base Class",id:"extract-common-setup-into-a-base-class",level:3},{value:"Locator Strategies",id:"locator-strategies",level:2},{value:"Prefer Resilient Locators",id:"prefer-resilient-locators",level:3},{value:"Avoid Brittle Locators",id:"avoid-brittle-locators",level:3},{value:"Use Chained Locators for Context",id:"use-chained-locators-for-context",level:3},{value:"Waiting Strategies",id:"waiting-strategies",level:2},{value:"Trust Playwright&#39;s Auto-Waiting",id:"trust-playwrights-auto-waiting",level:3},{value:"Use Explicit Waits When Needed",id:"use-explicit-waits-when-needed",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Provide Clear Assertions",id:"provide-clear-assertions",level:3},{value:"Handle Expected Failures Gracefully",id:"handle-expected-failures-gracefully",level:3},{value:"Performance Tips",id:"performance-tips",level:2},{value:"Use Headless Mode in CI",id:"use-headless-mode-in-ci",level:3},{value:"Minimize Browser Launches",id:"minimize-browser-launches",level:3},{value:"Use Network Mocking for Speed",id:"use-network-mocking-for-speed",level:3},{value:"Organizing Tests",id:"organizing-tests",level:2},{value:"Use Descriptive Test Names",id:"use-descriptive-test-names",level:3},{value:"Group Related Tests",id:"group-related-tests",level:3},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"Configure for CI Environments",id:"configure-for-ci-environments",level:3},{value:"Generate Reports in CI",id:"generate-reports-in-ci",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"Avoid Test Interdependencies",id:"avoid-test-interdependencies",level:3},{value:"Don&#39;t Ignore Flaky Tests",id:"dont-ignore-flaky-tests",level:3},{value:"Clean Up Test Data",id:"clean-up-test-data",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"best-practices",children:"Best Practices"})}),"\n",(0,r.jsx)(n.p,{children:"This guide covers best practices for writing maintainable, reliable, and efficient Serenity Playwright tests."}),"\n",(0,r.jsx)(n.h2,{id:"test-architecture",children:"Test Architecture"}),"\n",(0,r.jsx)(n.h3,{id:"follow-the-three-layer-pattern",children:"Follow the Three-Layer Pattern"}),"\n",(0,r.jsx)(n.p,{children:"Always structure your code in three layers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Tests (business scenarios)\n    \u2514\u2500\u2500 Step Libraries (reporting with @Step)\n          \u2514\u2500\u2500 Page Objects (locators and actions)\n"})}),"\n",(0,r.jsx)(n.p,{children:"This separation provides:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Maintainability"})," - Changes to UI only affect Page Objects"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Readability"})," - Tests read like specifications"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reusability"})," - Steps and Page Objects can be shared"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"keep-tests-focused",children:"Keep Tests Focused"}),"\n",(0,r.jsx)(n.p,{children:"Each test should verify one specific behavior:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u274c Bad: Testing too many things\n@Test\nvoid testEverything() {\n    login();\n    searchForProduct();\n    addToCart();\n    checkout();\n    verifyOrderConfirmation();\n    logout();\n    verifyLoggedOut();\n}\n\n// \u2705 Good: Focused tests\n@Test\nvoid shouldAddProductToCart() {\n    // Given\n    products.searchFor(page, "laptop");\n\n    // When\n    cart.addFirstResultToCart(page);\n\n    // Then\n    cart.verifyCartContains(page, "laptop");\n}\n\n@Test\nvoid shouldCompleteCheckout() {\n    // Given\n    cart.hasItemsInCart(page);\n\n    // When\n    checkout.completeOrder(page);\n\n    // Then\n    checkout.verifyOrderConfirmation(page);\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"browser-management",children:"Browser Management"}),"\n",(0,r.jsx)(n.h3,{id:"share-browser-isolate-pages",children:"Share Browser, Isolate Pages"}),"\n",(0,r.jsx)(n.p,{children:"Create the browser once per test class, but create a fresh page for each test:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@ExtendWith(SerenityJUnit5Extension.class)\nclass ProductTests {\n\n    private static Playwright playwright;\n    private static Browser browser;\n    private Page page;\n\n    @BeforeAll\n    static void setupBrowser() {\n        // Create browser once - expensive operation\n        playwright = Playwright.create();\n        browser = playwright.chromium().launch(\n            new BrowserType.LaunchOptions().setHeadless(true)\n        );\n    }\n\n    @AfterAll\n    static void closeBrowser() {\n        // Close browser after all tests\n        if (browser != null) browser.close();\n        if (playwright != null) playwright.close();\n    }\n\n    @BeforeEach\n    void setupPage() {\n        // Fresh page for each test - test isolation\n        page = browser.newPage();\n        PlaywrightSerenity.registerPage(page);\n    }\n\n    @AfterEach\n    void closePage() {\n        // Clean up after each test\n        PlaywrightSerenity.unregisterPage(page);\n        if (page != null) page.close();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"use-browser-contexts-for-isolation",children:"Use Browser Contexts for Isolation"}),"\n",(0,r.jsx)(n.p,{children:"For complete test isolation, use browser contexts:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@BeforeEach\nvoid setup() {\n    // Each context is completely isolated\n    BrowserContext context = browser.newContext();\n    page = context.newPage();\n    PlaywrightSerenity.registerPage(page);\n}\n\n@AfterEach\nvoid cleanup() {\n    PlaywrightSerenity.unregisterPage(page);\n    BrowserContext context = page.context();\n    page.close();\n    context.close();  // Closes all pages and clears cookies/storage\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"extract-common-setup-into-a-base-class",children:"Extract Common Setup into a Base Class"}),"\n",(0,r.jsx)(n.p,{children:"To reduce boilerplate across test classes, create a base class that handles Playwright lifecycle:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public abstract class SerenityPlaywrightTest {\n\n    protected Playwright playwright;\n    protected Browser browser;\n    protected Page page;\n\n    @BeforeEach\n    void setUpPlaywright() {\n        playwright = Playwright.create();\n        browser = playwright.chromium().launch(\n                new BrowserType.LaunchOptions().setHeadless(true)\n        );\n        page = browser.newPage();\n        PlaywrightSerenity.registerPage(page);\n    }\n\n    @AfterEach\n    void tearDownPlaywright() {\n        PlaywrightSerenity.unregisterPage(page);\n        if (page != null) page.close();\n        if (browser != null) browser.close();\n        if (playwright != null) playwright.close();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Test classes then extend this base and just wire up their step libraries:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@ExtendWith(SerenityJUnit5Extension.class)\n@DisplayName("When adding todos")\nclass WhenAddingTodosTest extends SerenityPlaywrightTest {\n\n    @Steps\n    TodoSteps todo;\n\n    @BeforeEach\n    void setUp() {\n        todo.setPage(page);  // Wire step library to the page\n    }\n\n    @Test\n    void shouldAddTodoItem() {\n        todo.openApplication();\n        todo.addTodo("Buy milk");\n\n        assertThat(todo.visibleTodoCount()).isEqualTo(1);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"This pattern:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Centralizes lifecycle management"})," - Changes to browser setup only need to happen in one place"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ensures proper cleanup"})," - The base class guarantees resources are released"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reduces test class boilerplate"})," - Each test class focuses on test logic"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Makes the ",(0,r.jsx)(n.code,{children:"page"})," accessible"]})," - Protected field is available to all subclasses"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"locator-strategies",children:"Locator Strategies"}),"\n",(0,r.jsx)(n.h3,{id:"prefer-resilient-locators",children:"Prefer Resilient Locators"}),"\n",(0,r.jsx)(n.p,{children:"Use locators in this order of preference:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Role-based"})," - Most resilient, uses accessibility semantics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Text-based"})," - Good for user-visible text"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Label-based"})," - Good for form fields"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test IDs"})," - Good for elements without semantic meaning"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CSS/XPath"})," - Last resort"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// 1. Role-based (best)\npage.getByRole(AriaRole.BUTTON, new Page.GetByRoleOptions().setName("Submit"));\n\n// 2. Text-based\npage.getByText("Add to Cart");\n\n// 3. Label-based\npage.getByLabel("Email address");\n\n// 4. Test ID\npage.getByTestId("checkout-button");\n\n// 5. CSS (avoid if possible)\npage.locator("button.submit-btn");\n'})}),"\n",(0,r.jsx)(n.h3,{id:"avoid-brittle-locators",children:"Avoid Brittle Locators"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u274c Brittle locators\npage.locator("div:nth-child(3) > button");\npage.locator(".btn-primary");\npage.locator("//div[@class=\'container\']/form/button[2]");\n\n// \u2705 Resilient locators\npage.getByRole(AriaRole.BUTTON, opts -> opts.setName("Place Order"));\npage.getByTestId("place-order-button");\n'})}),"\n",(0,r.jsx)(n.h3,{id:"use-chained-locators-for-context",children:"Use Chained Locators for Context"}),"\n",(0,r.jsx)(n.p,{children:"When the same element type appears multiple times:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// Find the "Add" button within the first product card\npage.locator("[data-testid=\'product-card\']").first()\n    .getByRole(AriaRole.BUTTON, new GetByRoleOptions().setName("Add"));\n\n// Find the email field in the shipping section\npage.locator("#shipping-section")\n    .getByLabel("Email");\n'})}),"\n",(0,r.jsx)(n.h2,{id:"waiting-strategies",children:"Waiting Strategies"}),"\n",(0,r.jsx)(n.h3,{id:"trust-playwrights-auto-waiting",children:"Trust Playwright's Auto-Waiting"}),"\n",(0,r.jsx)(n.p,{children:"Playwright automatically waits for elements to be actionable. Don't add unnecessary waits:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u274c Unnecessary - Playwright already waits\nThread.sleep(2000);\npage.locator("#button").waitFor();\npage.locator("#button").click();\n\n// \u2705 Just click - Playwright waits automatically\npage.locator("#button").click();\n'})}),"\n",(0,r.jsx)(n.h3,{id:"use-explicit-waits-when-needed",children:"Use Explicit Waits When Needed"}),"\n",(0,r.jsx)(n.p,{children:"For specific conditions, use explicit waits:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// Wait for navigation to complete\npage.waitForURL("**/checkout");\n\n// Wait for network requests to finish\npage.waitForLoadState(LoadState.NETWORKIDLE);\n\n// Wait for a specific condition\npage.waitForCondition(() -> getItemCount() >= 5);\n\n// Wait for element to be hidden\nloadingSpinner().waitFor(new WaitForOptions()\n    .setState(WaitForSelectorState.HIDDEN));\n'})}),"\n",(0,r.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.h3,{id:"provide-clear-assertions",children:"Provide Clear Assertions"}),"\n",(0,r.jsx)(n.p,{children:"Use descriptive assertion messages:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Step("Verify cart total is ${1}")\npublic void verifyCartTotal(Page page, BigDecimal expected) {\n    BigDecimal actual = cartPage.getTotal();\n    assertThat(actual)\n        .as("Cart total should be $%s but was $%s", expected, actual)\n        .isEqualByComparingTo(expected);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"handle-expected-failures-gracefully",children:"Handle Expected Failures Gracefully"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Step("Verify error message is shown")\npublic void verifyErrorMessage(Page page, String expectedMessage) {\n    Locator errorLocator = page.locator(".error-message");\n\n    assertThat(errorLocator.isVisible())\n        .as("Error message should be visible")\n        .isTrue();\n\n    assertThat(errorLocator.textContent())\n        .as("Error message content")\n        .contains(expectedMessage);\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,r.jsx)(n.h3,{id:"use-headless-mode-in-ci",children:"Use Headless Mode in CI"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'boolean isCI = System.getenv("CI") != null;\nbrowser = playwright.chromium().launch(\n    new BrowserType.LaunchOptions().setHeadless(isCI)\n);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"minimize-browser-launches",children:"Minimize Browser Launches"}),"\n",(0,r.jsx)(n.p,{children:"Browser launches are expensive. Share browsers across tests:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// One browser per test class\n@BeforeAll\nstatic void launchBrowser() { ... }\n\n// NOT: One browser per test\n@BeforeEach\nvoid launchBrowser() { ... }  // \u274c Slow!\n"})}),"\n",(0,r.jsx)(n.h3,{id:"use-network-mocking-for-speed",children:"Use Network Mocking for Speed"}),"\n",(0,r.jsx)(n.p,{children:"Mock slow API calls in tests:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@BeforeEach\nvoid setupMocks() {\n    // Mock slow API endpoint\n    page.route("**/api/recommendations", route -> {\n        route.fulfill(new FulfillOptions()\n            .setStatus(200)\n            .setBody("[]"));\n    });\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"organizing-tests",children:"Organizing Tests"}),"\n",(0,r.jsx)(n.h3,{id:"use-descriptive-test-names",children:"Use Descriptive Test Names"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\n@DisplayName("Should display error when login fails with invalid password")\nvoid shouldDisplayErrorWhenLoginFailsWithInvalidPassword() {\n    // ...\n}\n\n@Test\n@DisplayName("Should redirect to dashboard after successful login")\nvoid shouldRedirectToDashboardAfterSuccessfulLogin() {\n    // ...\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"group-related-tests",children:"Group Related Tests"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Nested\n@DisplayName("When user is logged in")\nclass WhenLoggedIn {\n\n    @BeforeEach\n    void login() {\n        auth.loginAs(page, testUser);\n    }\n\n    @Test\n    void shouldDisplayWelcomeMessage() { ... }\n\n    @Test\n    void shouldShowOrderHistory() { ... }\n}\n\n@Nested\n@DisplayName("When user is not logged in")\nclass WhenNotLoggedIn {\n\n    @Test\n    void shouldShowLoginPrompt() { ... }\n\n    @Test\n    void shouldRedirectToLoginPage() { ... }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,r.jsx)(n.h3,{id:"configure-for-ci-environments",children:"Configure for CI Environments"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@BeforeAll\nstatic void setup() {\n    playwright = Playwright.create();\n\n    BrowserType.LaunchOptions options = new BrowserType.LaunchOptions()\n        .setHeadless(true)\n        .setArgs(Arrays.asList(\n            "--no-sandbox",\n            "--disable-dev-shm-usage"\n        ));\n\n    browser = playwright.chromium().launch(options);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"generate-reports-in-ci",children:"Generate Reports in CI"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# GitHub Actions example\n- name: Run Tests\n  run: mvn verify\n\n- name: Upload Serenity Reports\n  uses: actions/upload-artifact@v3\n  if: always()\n  with:\n    name: serenity-reports\n    path: target/site/serenity/\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,r.jsx)(n.h3,{id:"avoid-test-interdependencies",children:"Avoid Test Interdependencies"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// \u274c Bad: Tests depend on each other\n@Test\n@Order(1)\nvoid createUser() {\n    createdUserId = userService.create(user);\n}\n\n@Test\n@Order(2)\nvoid verifyUser() {\n    userService.get(createdUserId);  // Fails if first test fails\n}\n\n// \u2705 Good: Each test is independent\n@Test\nvoid shouldCreateAndVerifyUser() {\n    String userId = userService.create(user);\n    User retrieved = userService.get(userId);\n    assertThat(retrieved).isEqualTo(user);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dont-ignore-flaky-tests",children:"Don't Ignore Flaky Tests"}),"\n",(0,r.jsx)(n.p,{children:"Address flaky tests immediately:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u274c Don\'t do this\n@Disabled("Flaky - investigate later")\n@Test\nvoid sometimesFailingTest() { ... }\n\n// \u2705 Fix the root cause\n@Test\nvoid fixedTest() {\n    // Wait for specific condition instead of arbitrary sleep\n    page.waitForLoadState(LoadState.NETWORKIDLE);\n    // Now perform assertion\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"clean-up-test-data",children:"Clean Up Test Data"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@AfterEach\nvoid cleanup() {\n    // Clean up any test data created\n    if (createdOrderId != null) {\n        orderService.delete(createdOrderId);\n    }\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>i,x:()=>o});var t=s(6540);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);