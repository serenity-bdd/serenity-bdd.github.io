"use strict";(globalThis.webpackChunkserenity_users_guide=globalThis.webpackChunkserenity_users_guide||[]).push([[2226],{389(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"spring/integration_testing_spring","title":"Testes de Integra\xe7\xe3o com Spring","description":"Projetos Spring s\xe3o bem adequados para executar seus testes de aceita\xe7\xe3o contra diferentes camadas da sua aplica\xe7\xe3o.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/spring/integration-testing-spring.md","sourceDirName":"spring","slug":"/spring/integration_testing_spring","permalink":"/pt-BR/docs/spring/integration_testing_spring","draft":false,"unlisted":false,"editUrl":"https://github.com/serenity-bdd/serenity-bdd.github.io/blob/master/docs/spring/integration-testing-spring.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"integration_testing_spring","title":"Testes de Integra\xe7\xe3o com Spring","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Integra\xe7\xe3o com Cucumber","permalink":"/pt-BR/docs/playwright/playwright_cucumber"},"next":{"title":"Os Relat\xf3rios do Serenity","permalink":"/pt-BR/docs/reporting/the_serenity_reports"}}');var a=t(4848),o=t(8453);const r={id:"integration_testing_spring",title:"Testes de Integra\xe7\xe3o com Spring",sidebar_position:1},s=void 0,d={},c=[{value:"No Spring Boot &lt;1.3",id:"no-spring-boot-13",level:3}];function u(e){const n={code:"code",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Projetos Spring s\xe3o bem adequados para executar seus testes de aceita\xe7\xe3o contra diferentes camadas da sua aplica\xe7\xe3o."}),"\n",(0,a.jsx)(n.p,{children:"Com Serenity, voc\xea pode garantir o comportamento correto usando um navegador ou a API REST ou trabalhar diretamente com a camada de servi\xe7os da sua aplica\xe7\xe3o."}),"\n",(0,a.jsx)(n.p,{children:"Ocasionalmente, tamb\xe9m pode ser \xfatil acessar as camadas de servi\xe7o diretamente em seus testes end-to-end baseados em navegador."}),"\n",(0,a.jsx)(n.p,{children:"Por exemplo, voc\xea pode ter um cen\xe1rio onde uma a\xe7\xe3o do usu\xe1rio deve, como efeito colateral, registrar um log de auditoria em uma tabela no banco de dados."}),"\n",(0,a.jsx)(n.p,{children:"Para manter seu teste focado e simples, voc\xea pode querer chamar a camada de servi\xe7o diretamente para verificar os logs de auditoria, em vez de usar o navegador para fazer login como administrador e navegar at\xe9 a tela de logs de auditoria."}),"\n",(0,a.jsxs)(n.p,{children:["Testes de integra\xe7\xe3o devem usar o ",(0,a.jsx)(n.code,{children:"SerenityRunner"}),".\nPara poder injetar (por exemplo, ",(0,a.jsx)(n.code,{children:"@Autowired"}),") depend\xeancias e usar as anota\xe7\xf5es usuais (como ",(0,a.jsx)(n.code,{children:"@DirtiesContext"}),"), voc\xea s\xf3 precisa incluir a ",(0,a.jsx)(n.code,{children:"SpringIntegrationMethodRule"})," do Serenity na sua classe de teste."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@RunWith(SerenityRunner.class)\n@SpringBootTest\npublic class WhenInjectingSpringDependencies {\n\n    @Managed\n    WebDriver driver;\n\n    @ManagedPages(defaultUrl = "http://www.google.com")\n    public Pages pages;\n\n    @Rule\n    public SpringIntegrationMethodRule springIntegrationMethodRule =\n      new SpringIntegrationMethodRule();\n\n    @Autowired\n    public GizmoService gizmoService;\n\n    @Test\n    public void shouldInstantiateGizmoService() {\n        assertThat(gizmoService, is(not(nullValue())));\n    }\n\n    @Test\n    public void shouldInstantiateNestedServices() {\n        assertThat(gizmoService.getWidgetService(), is(not(nullValue())));\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"no-spring-boot-13",children:"No Spring Boot <1.3"}),"\n",(0,a.jsxs)(n.p,{children:["use a anota\xe7\xe3o ",(0,a.jsx)(n.code,{children:"@ContextConfiguration"})," para definir o arquivo ou arquivos de configura\xe7\xe3o a usar. Ent\xe3o voc\xea pode injetar depend\xeancias como faria em um teste de integra\xe7\xe3o Spring comum, usando as anota\xe7\xf5es Spring usuais como ",(0,a.jsx)(n.code,{children:"@Autowired"})," ou ",(0,a.jsx)(n.code,{children:"@Resource"}),". Por exemplo, suponha que estamos usando o seguinte arquivo de configura\xe7\xe3o Spring, chamado 'config.xml':"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:'<beans>\n    <bean id="widgetService" class="net.serenity.junit.spring.WidgetService">\n        <property name="name"><value>Widgets</value></property>\n        <property name="quota"><value>1</value></property>\n    </bean>\n    <bean id="gizmoService" class="net.serenity.junit.spring.GizmoService">\n        <property name="name"><value>Gizmos</value></property>\n        <property name="widgetService"><ref bean="widgetService" /></property>\n    </bean>\n</beans>\n'})}),"\n",(0,a.jsx)(n.p,{children:"Podemos usar este arquivo de configura\xe7\xe3o para injetar depend\xeancias como mostrado aqui:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@RunWith(SerenityRunner.class)\n@ContextConfiguration(locations = "/config.xml")\npublic class WhenInjectingSpringDependencies {\n\n    @Managed\n    WebDriver driver;\n\n    @ManagedPages(defaultUrl = "http://www.google.com")\n    public Pages pages;\n\n    @Rule\n    public SpringIntegrationMethodRule springIntegrationMethodRule = new SpringIntegrationMethodRule();\n\n    @Autowired\n    public GizmoService gizmoService;\n\n    @Test\n    public void shouldInstantiateGizmoService() {\n        assertThat(gizmoService, is(not(nullValue())));\n    }\n\n    @Test\n    public void shouldInstantiateNestedServices() {\n        assertThat(gizmoService.getWidgetService(), is(not(nullValue())));\n    }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Outras anota\xe7\xf5es relacionadas a contexto como ",(0,a.jsx)(n.code,{children:"@DirtiesContext"})," tamb\xe9m funcionar\xe3o como funcionariam em um teste de integra\xe7\xe3o Spring tradicional. O Spring criar\xe1 um novo ApplicationContext para cada teste, mas usar\xe1 um \xfanico ApplicationContext para todos os m\xe9todos no seu teste. Se um dos seus testes modificar um objeto no ApplicationContext, voc\xea pode querer informar o Spring para que ele possa resetar o contexto para o pr\xf3ximo teste. Voc\xea faz isso usando a anota\xe7\xe3o ",(0,a.jsx)(n.code,{children:"@DirtiesContext"}),". No seguinte caso de teste, por exemplo, os testes falhar\xe3o sem a anota\xe7\xe3o ",(0,a.jsx)(n.code,{children:"@DirtiesContext"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@RunWith(SerenityRunner.class)\n@ContextConfiguration(locations = "/spring/config.xml")\npublic class WhenWorkingWithDirtyContexts {\n\n    @Managed\n    WebDriver driver;\n\n    @ManagedPages(defaultUrl = "http://www.google.com")\n    public Pages pages;\n\n    @Rule\n    public SpringIntegration springIntegration = new SpringIntegration();\n\n    @Autowired\n    public GizmoService gizmoService;\n\n    @Test\n    @DirtiesContext\n    public void shouldNotBeAffectedByTheOtherTest() {\n        assertThat(gizmoService.getName(), is("Gizmos"));\n        gizmoService.setName("New Gizmos");\n    }\n\n    @Test\n    @DirtiesContext\n    public void shouldNotBeAffectedByTheOtherTestEither() {\n        assertThat(gizmoService.getName(), is("Gizmos"));\n        gizmoService.setName("New Gizmos");\n    }\n\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Voc\xea tamb\xe9m pode injetar depend\xeancias Spring diretamente nas suas bibliotecas de passos, para JUnit, Cucumber e JBehave, como mostrado neste exemplo:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@ContextConfiguration(locations = "/spring/config.xml")\npublic class NestedSpringEnabledSteps {\n\n    @Autowired\n    public WidgetService widgetService;\n\n    private String widgetName;\n\n    @Steps\n    private NestedSteps nestedSteps;\n\n    @Given("I have a nested autowired Spring bean")\n    public void givenIHaveAnAutowiredSpringBean() {\n        assertThat(nestedSteps.widgetService, notNullValue());\n    }\n\n    @When("I use the nested bean")\n    public void whenIUseTheBean() {\n        widgetName = nestedSteps.widgetService.getName();\n    }\n\n    @Then("the nested bean should be instantiated")\n    public void thenItShouldBeInstantiated() {\n        assertThat(widgetName, is("Widgets"));\n    }\n\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>s});var i=t(6540);const a={},o=i.createContext(a);function r(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);