"use strict";(globalThis.webpackChunkserenity_users_guide=globalThis.webpackChunkserenity_users_guide||[]).push([[3137],{77(e,s,a){a.d(s,{A:()=>t});const t=a.p+"assets/images/calculator-app-15faebe39eed240aa4b761e9f492c763.png"},2996(e,s,a){a.d(s,{A:()=>t});const t=a.p+"assets/images/calculator-step-screenshots-f155907793e985d481afe765cc342085.png"},3773(e,s,a){a.d(s,{A:()=>t});const t=a.p+"assets/images/calculator-steps-5da4a36b105ab6c58ccc74f377dab106.png"},8089(e,s,a){a.d(s,{A:()=>t});const t=a.p+"assets/images/persona-steps-e3e5d126e535bceb61d05022b43ca6a7.png"},8453(e,s,a){a.d(s,{R:()=>i,x:()=>r});var t=a(6540);const o={},n=t.createContext(o);function i(e){const s=t.useContext(n);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(n.Provider,{value:s},e.children)}},8989(e,s,a){a.r(s),a.d(s,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"guide/step_libraries","title":"Bibliotecas de Passos","description":"No Serenity, os testes s\xe3o divididos em passos reutiliz\xe1veis. Um princ\xedpio importante por tr\xe1s do Serenity \xe9 a ideia de que \xe9 mais f\xe1cil manter um teste que usa v\xe1rias camadas de abstra\xe7\xe3o para esconder a complexidade por tr\xe1s de diferentes partes de um teste.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/guide/steps.md","sourceDirName":"guide","slug":"/guide/step_libraries","permalink":"/pt-BR/docs/guide/step_libraries","draft":false,"unlisted":false,"editUrl":"https://github.com/serenity-bdd/serenity-bdd.github.io/blob/master/docs/guide/steps.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"step_libraries","title":"Bibliotecas de Passos","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Usando Maven com Serenity","permalink":"/pt-BR/docs/guide/maven"},"next":{"title":"Interagindo com P\xe1ginas Web","permalink":"/pt-BR/docs/guide/page_objects"}}');var o=a(4848),n=a(8453);const i={id:"step_libraries",title:"Bibliotecas de Passos",sidebar_position:4},r="Bibliotecas de Passos do Serenity",d={},c=[{value:"Dividindo testes em passos",id:"dividindo-testes-em-passos",level:2},{value:"Implementando Bibliotecas de Passos Simples",id:"implementando-bibliotecas-de-passos-simples",level:2},{value:"Classes de Intera\xe7\xe3o com UI",id:"classes-de-intera\xe7\xe3o-com-ui",level:3},{value:"Bibliotecas de Passos de Persona",id:"bibliotecas-de-passos-de-persona",level:3},{value:"Inst\xe2ncias Compartilhadas de Bibliotecas de Passos",id:"inst\xe2ncias-compartilhadas-de-bibliotecas-de-passos",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"bibliotecas-de-passos-do-serenity",children:"Bibliotecas de Passos do Serenity"})}),"\n",(0,o.jsx)(s.p,{children:"No Serenity, os testes s\xe3o divididos em passos reutiliz\xe1veis. Um princ\xedpio importante por tr\xe1s do Serenity \xe9 a ideia de que \xe9 mais f\xe1cil manter um teste que usa v\xe1rias camadas de abstra\xe7\xe3o para esconder a complexidade por tr\xe1s de diferentes partes de um teste."}),"\n",(0,o.jsx)(s.p,{children:"Em um teste de aceita\xe7\xe3o automatizado, os passos de teste representam o n\xedvel de abstra\xe7\xe3o entre o c\xf3digo que interage com sua aplica\xe7\xe3o (por exemplo, Page Component Objects em um teste web automatizado, que modelam partes da interface do usu\xe1rio, ou endpoints de API para servi\xe7os web com os quais voc\xea precisa interagir) e hist\xf3rias de n\xedvel superior (sequ\xeancias de a\xe7\xf5es mais focadas no neg\xf3cio que ilustram como uma determinada hist\xf3ria de usu\xe1rio foi implementada). Se seu teste automatizado n\xe3o \xe9 orientado a UI (por exemplo, se ele chama um servi\xe7o web), os passos orquestram outros componentes mais t\xe9cnicos, como clientes REST. Passos podem conter outros passos e s\xe3o inclu\xeddos nos relat\xf3rios do Serenity. Sempre que um passo de UI \xe9 executado, uma captura de tela \xe9 armazenada e exibida no relat\xf3rio."}),"\n",(0,o.jsx)(s.h2,{id:"dividindo-testes-em-passos",children:"Dividindo testes em passos"}),"\n",(0,o.jsx)(s.p,{children:"Suponha que estamos testando um programa de Passageiro Frequente e precisamos ilustrar as seguintes regras de neg\xf3cio:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Membros devem come\xe7ar com status Bronze"}),"\n",(0,o.jsx)(s.li,{children:"Membros devem ganhar status Silver ap\xf3s voar 10.000 km."}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Cada uma dessas pode ser dividida ainda mais em tarefas de neg\xf3cio e verifica\xe7\xf5es. Por exemplo, a primeira regra pode ser dividida em dois passos:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Criar um novo membro Passageiro Frequente"}),"\n",(0,o.jsx)(s.li,{children:"Verificar que o membro tem status Bronze"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"E a segunda pode ser dividida em tr\xeas passos:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Criar um novo membro Passageiro Frequente"}),"\n",(0,o.jsx)(s.li,{children:"Fazer o membro voar 10000 km"}),"\n",(0,o.jsx)(s.li,{children:"Verificar que o membro tem status Silver"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Poder\xedamos expressar esses testes usando Serenity no JUnit 5 da seguinte forma:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:"package flyer;\n\nimport net.serenitybdd.junit5.SerenityJUnit5Extension;\nimport net.thucydides.core.annotations.Steps;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport flyer.steps.TravellerEarningStatusPoints;\n\nimport static flyer.Status.Bronze;\nimport static flyer.Status.Silver;\n\n@ExtendWith(SerenityJUnit5Extension.class)\nclass WhenEarningFrequentFlyerPoints {\n\n    @Steps\n    TravellerEarningStatusPoints tracy;\n\n    @Test\n    void members_should_start_with_Bronze_status() {\n        // DADO\n        tracy.joins_the_frequent_flyer_program();\n\n        // ENT\xc3O\n        tracy.should_have_a_status_of(Bronze);\n    }\n\n    @Test\n    void earn_silver_after_10000_kilometers() {\n        // DADO\n        tracy.joins_the_frequent_flyer_program();\n\n        // QUANDO\n        tracy.flies(10000);\n\n        // ENT\xc3O\n        tracy.should_have_a_status_of(Silver);\n    }\n}\n"})}),"\n",(0,o.jsx)(s.admonition,{title:"JUnit 4 Obsoleto",type:"note",children:(0,o.jsxs)(s.p,{children:["Se voc\xea ainda est\xe1 usando JUnit 4 com ",(0,o.jsx)(s.code,{children:"@RunWith(SerenityRunner.class)"}),", observe que o suporte ao JUnit 4 est\xe1 obsoleto a partir do Serenity 5.0.0 e ser\xe1 removido no Serenity 6.0.0. Por favor, migre para o JUnit 5 usando ",(0,o.jsx)(s.code,{children:"@ExtendWith(SerenityJUnit5Extension.class)"})," como mostrado acima."]})}),"\n",(0,o.jsx)(s.p,{children:"Observe como o segundo teste reutiliza m\xe9todos de passo usados no primeiro para realizar um teste ligeiramente diferente. Este \xe9 um exemplo t\xedpico da forma como reutilizamos passos em testes semelhantes, a fim de evitar c\xf3digo duplicado e tornar o c\xf3digo mais f\xe1cil de manter."}),"\n",(0,o.jsx)(s.h2,{id:"implementando-bibliotecas-de-passos-simples",children:"Implementando Bibliotecas de Passos Simples"}),"\n",(0,o.jsxs)(s.p,{children:["A classe ",(0,o.jsx)(s.code,{children:"TravellerEarningStatusPoints"})," \xe9 o que chamamos de biblioteca de passos. Usamos a classe ",(0,o.jsx)(s.code,{children:"@Steps"})," como mostrado acima para indicar uma biblioteca de passos em nosso c\xf3digo de teste: esta anota\xe7\xe3o diz ao Serenity para instanciar e instrumentar este campo, para que os m\xe9todos que voc\xea chamar nesta biblioteca tamb\xe9m apare\xe7am nos relat\xf3rios de teste."]}),"\n",(0,o.jsx)(s.p,{children:"Bibliotecas de passos cont\xeam as tarefas de neg\xf3cio ou a\xe7\xf5es que um usu\xe1rio realiza durante um teste. Existem muitas maneiras de organizar suas bibliotecas de passos, mas uma maneira conveniente \xe9 agrupar m\xe9todos em fatias de comportamento de neg\xf3cio para um determinado tipo de usu\xe1rio. Neste caso, um viajante que est\xe1 ganhando pontos de status."}),"\n",(0,o.jsxs)(s.p,{children:["Observe que n\xe3o foi necess\xe1rio instanciar explicitamente a classe Steps ",(0,o.jsx)(s.code,{children:"TravellerEarningStatusPoints"}),". Quando voc\xea anota uma vari\xe1vel membro desta classe com a anota\xe7\xe3o ",(0,o.jsx)(s.code,{children:"@Steps"}),", o Serenity BDD automaticamente a instanciar\xe1 para voc\xea."]}),"\n",(0,o.jsxs)(s.p,{children:["Voc\xea nunca deve criar inst\xe2ncias de bibliotecas de passos usando a palavra-chave ",(0,o.jsx)(s.code,{children:"new"}),", pois o Serenity n\xe3o ser\xe1 capaz de instrumentar a biblioteca de passos corretamente, e os m\xe9todos chamados n\xe3o aparecer\xe3o nos relat\xf3rios."]}),"\n",(0,o.jsxs)(s.p,{children:["Por exemplo, suponha que queremos testar uma UI de calculadora simples. Nesta classe, usamos a biblioteca de passos ",(0,o.jsx)(s.code,{children:"CalculatorSteps"}),", que anotamos com a anota\xe7\xe3o ",(0,o.jsx)(s.code,{children:"@Steps"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:'@ExtendWith(SerenityJUnit5Extension.class)\nclass WhenDoingSums {\n\n    @Steps\n    CalculatorSteps calulate;\n\n    @Nested\n    class ABasicCalculator {\n\n        @BeforeEach\n        void openTheCalculator() {\n            calulate.openTheCalculatorApp();\n        }\n\n        @Test\n        void shouldCalculateAdditions() {\n            int result = calulate.theAnswerTo("1","+","2");\n            assertThat(result).isEqualTo(3);\n        }\n\n        @Test\n        void shouldCalculateSubtractions() {\n            int result = calulate.theAnswerTo("7","-","3");\n            assertThat(result).isEqualTo(4);\n        }\n\n        @Test\n        void shouldCalculateMultiplications() {\n            int result = calulate.theAnswerTo("3","*","2");\n            assertThat(result).isEqualTo(6);\n        }\n\n        @Test\n        void shouldCalculateDivisions() {\n            int result = calulate.theAnswerTo("10","/","2");\n            assertThat(result).isEqualTo(5);\n        }\n    }\n}\n'})}),"\n",(0,o.jsxs)(s.p,{children:["A classe ",(0,o.jsx)(s.code,{children:"CalculatorSteps"})," define os passos que um usu\xe1rio precisa realizar - neste caso, realizar um c\xe1lculo no aplicativo de calculadora:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:'public class CalculatorSteps {\n\n    @Step("Calculate the answer to {0} {1} {2}")\n    public int theAnswerTo(String a, String operator, String b) {\n        // Interagir com a calculadora para realizar o c\xe1lculo\n    }\n}\n'})}),"\n",(0,o.jsxs)(s.p,{children:["M\xe9todos de passo s\xe3o anotados com a anota\xe7\xe3o ",(0,o.jsx)(s.code,{children:"@Step"}),", que diz ao Serenity para incluir este m\xe9todo nos relat\xf3rios de teste do Serenity. O valor que inclu\xedmos na anota\xe7\xe3o ",(0,o.jsx)(s.code,{children:"@Step"})," \xe9 o texto que aparecer\xe1 nos relat\xf3rios do Serenity quando este passo for executado. Os n\xfameros entre chaves (",(0,o.jsx)(s.code,{children:"{0}"}),",",(0,o.jsx)(s.code,{children:"{1}"})," e ",(0,o.jsx)(s.code,{children:"{2}"}),") representam placeholders para os par\xe2metros do m\xe9todo, se quisermos que eles apare\xe7am nos relat\xf3rios."]}),"\n",(0,o.jsx)(s.p,{children:"Quando executamos este caso de teste, o Serenity documentar\xe1 os passos que s\xe3o executados durante cada teste, produzindo uma documenta\xe7\xe3o viva da execu\xe7\xe3o do teste:"}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.img,{src:a(3773).A+"",width:"3296",height:"2030"})}),"\n",(0,o.jsx)(s.h3,{id:"classes-de-intera\xe7\xe3o-com-ui",children:"Classes de Intera\xe7\xe3o com UI"}),"\n",(0,o.jsxs)(s.p,{children:["Suponha que nosso teste de calculadora precise interagir com uma UI web, como a em ",(0,o.jsx)(s.a,{href:"https://juliemr.github.io/protractor-demo/",children:"https://juliemr.github.io/protractor-demo/"})," mostrada aqui:"]}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.img,{src:a(77).A+"",width:"2132",height:"706"})}),"\n",(0,o.jsxs)(s.p,{children:["Podemos acessar a poderosa integra\xe7\xe3o Selenium do Serenity BDD em nossas bibliotecas de passos estendendo a classe ",(0,o.jsx)(s.code,{children:"net.serenitybdd.core.steps.UIInteractions"}),". Uma implementa\xe7\xe3o muito simples poderia parecer assim:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:'public class CalculatorSteps extends UIInteractions {\n\n     @Step\n    public void openTheCalculatorApp() {\n        openUrl("https://juliemr.github.io/protractor-demo/");\n    }\n\n   @Step("Calculate the answer to {0} {1} {2}")\n    public int theAnswerTo(String firstValue, String operator, String secondValue) {\n\n        $("[ng-model=first]").sendKeys(firstValue);\n        $("[ng-model=operator]").selectByVisibleText(operator);\n        $("[ng-model=second]").sendKeys(secondValue);\n        $("#gobutton").click();\n        waitForAngularRequestsToFinish();\n\n        return Integer.parseInt($("css:h2").getText());\n    }\n}\n'})}),"\n",(0,o.jsx)(s.p,{children:"Uma implementa\xe7\xe3o mais leg\xedvel e refatorada poderia parecer assim:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:'public class CalculatorSteps extends UIInteractions {\n\n    private static final By FIRST_VALUE_FIELD = By.cssSelector("[ng-model=first]");\n    private static final By SECOND_VALUE_FIELD = By.cssSelector("[ng-model=second]");\n    private static final By OPERATOR_DROPDOWN = By.cssSelector("[ng-model=operator]");\n    private static final By GO_BUTTON = By.id("gobutton");\n    private static final By RESULT_FIELD = By.tagName("h2");\n    private static final Pattern A_VALID_NUMBER = Pattern.compile("-?\\\\d\\\\.?d*");\n\n    @Step\n    public void openTheCalculatorApp() {\n        openUrl("https://juliemr.github.io/protractor-demo/");\n    }\n\n    @Step("Calculate the answer to {0} {1} {2}")\n    public int theAnswerTo(String firstValue, String operator, String secondValue) {\n\n        $(FIRST_VALUE_FIELD).sendKeys(firstValue);\n        $(OPERATOR_DROPDOWN).selectByVisibleText(operator);\n        $(SECOND_VALUE_FIELD).sendKeys(secondValue);\n        $(GO_BUTTON).click();\n        waitFor(ExpectedConditions.textMatches(RESULT_FIELD,A_VALID_NUMBER));\n\n        return Integer.parseInt($(RESULT_FIELD).getText());\n    }\n}\n'})}),"\n",(0,o.jsx)(s.p,{children:"Os testes agora interagir\xe3o com a interface do usu\xe1rio, relatar\xe3o tanto os passos executados quanto (se configurado para fazer isso) registrar\xe3o capturas de tela para cada passo:"}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.img,{src:a(2996).A+"",width:"2202",height:"1488"})}),"\n",(0,o.jsx)(s.h3,{id:"bibliotecas-de-passos-de-persona",children:"Bibliotecas de Passos de Persona"}),"\n",(0,o.jsx)(s.p,{children:"Outra abordagem para modelar bibliotecas de passos gira em torno de atores e pap\xe9is. Vamos voltar ao nosso exemplo original: Tracy, a viajante, que ganha pontos quando viaja."}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:'public class TravellerEarningStatusPoints {\n\n    private String actor;\n\n    private FrequentFlyer frequentFlyer;\n\n    @Step("#actor joins the frequent flyer program")\n    public void joins_the_frequent_flyer_program() {\n        frequentFlyer = FrequentFlyer.withInitialBalanceOf(0);\n    }\n\n    @Step("#actor flies {0} km")\n    public void flies(int distance) {\n        frequentFlyer.recordFlightDistanceInKilometers(distance);\n    }\n\n    @Step("#actor should have a status of {0}")\n    public void should_have_a_status_of(Status expectedStatus) {\n        assertThat(frequentFlyer.getStatus()).isEqualTo(expectedStatus);\n    }\n\n    @Step("#actor transfers {0} points to {1}")\n    public void transfers_points(int points, TravellerEarningStatusPoints otherFrequentFlier) {\n        // Deixado como exerc\xedcio\n    }\n\n    @Override\n    public String toString() {\n        return actor;\n    }\n\n    @Step("#actor should have {0} points")\n    public void should_have_points(int expectedPoints) {\n        // Deixado como exerc\xedcio\n    }\n}\n'})}),"\n",(0,o.jsxs)(s.p,{children:["Esta abordagem usa o conceito de bibliotecas de passos de ",(0,o.jsx)(s.em,{children:"persona"}),", onde uma biblioteca de passos representa as a\xe7\xf5es de um usu\xe1rio espec\xedfico realizando uma tarefa espec\xedfica (Tracy a viajante que est\xe1 ganhando pontos). Neste caso, o Serenity automaticamente instanciar\xe1 o campo ",(0,o.jsx)(s.em,{children:"actor"})," com o nome da vari\xe1vel da biblioteca de passos (",(0,o.jsx)(s.code,{children:"tracy"}),"), permitindo que apare\xe7a nos relat\xf3rios de teste para torn\xe1-los mais leg\xedveis:"]}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.img,{src:a(8089).A+"",width:"2422",height:"1408"})}),"\n",(0,o.jsx)(s.h2,{id:"inst\xe2ncias-compartilhadas-de-bibliotecas-de-passos",children:"Inst\xe2ncias Compartilhadas de Bibliotecas de Passos"}),"\n",(0,o.jsx)(s.p,{children:"Existem alguns casos em que queremos reutilizar a mesma inst\xe2ncia de biblioteca de passos em diferentes lugares ao longo de um teste. Por exemplo, suponha que temos uma biblioteca de passos que interage com uma API de backend, e que mant\xe9m algum estado interno e cache para melhorar o desempenho. Podemos querer reutilizar uma \xfanica inst\xe2ncia desta biblioteca de passos, em vez de ter uma inst\xe2ncia separada para cada vari\xe1vel."}),"\n",(0,o.jsx)(s.p,{children:"Podemos fazer isso declarando a biblioteca de passos como compartilhada, assim:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-java",children:"@Steps(shared = true)\nCustomerAPIStepLibrary customerAPI;\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Agora, quaisquer outras bibliotecas de passos do tipo ",(0,o.jsx)(s.code,{children:"CustomerAPIStepLibrary"}),", que tenham o atributo shared definido como true, se referir\xe3o \xe0 mesma inst\xe2ncia."]}),"\n",(0,o.jsx)(s.p,{children:"Em vers\xf5es anteriores do Serenity, compartilhar inst\xe2ncias era o comportamento padr\xe3o, e voc\xea usava o atributo uniqueInstance para indicar que uma biblioteca de passos n\xe3o deveria ser compartilhada. Se voc\xea precisar for\xe7ar este comportamento para su\xedtes de teste legadas, defina a propriedade step.creation.strategy como legacy no seu arquivo serenity.properties:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-javascript",children:"step.creation.strategy = legacy\n"})})]})}function u(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);