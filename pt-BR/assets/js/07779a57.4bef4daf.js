"use strict";(globalThis.webpackChunkserenity_users_guide=globalThis.webpackChunkserenity_users_guide||[]).push([[2828],{886(e,a,s){s.d(a,{A:()=>n});const n=s.p+"assets/images/find-a-user-by-id-027d199be318af7f5c3207b9d63806ba.png"},4278(e,a,s){s.r(a),s.d(a,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"screenplay/screenplay_rest","title":"Trabalhando com APIs REST usando Serenity Screenplay","description":"O Screenplay Pattern e uma abordagem para escrever testes de aceitacao automatizados que nos ajuda a escrever codigo de automacao mais limpo, mais facil de manter e mais escalavel. Um teste Screenplay fala primeiro e principalmente sobre as Task que um usuario executa, em linguagem de negocios, em vez de mergulhar nos detalhes sobre botoes, cliques e campos de entrada. Focar nas Task de negocios torna nossos testes mais legiveis, mais faceis de manter e mais faceis de escalar.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/screenplay/screenplay-rest.md","sourceDirName":"screenplay","slug":"/screenplay/screenplay_rest","permalink":"/pt-BR/docs/screenplay/screenplay_rest","draft":false,"unlisted":false,"editUrl":"https://github.com/serenity-bdd/serenity-bdd.github.io/blob/master/docs/screenplay/screenplay-rest.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"screenplay_rest","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Testes Web com Serenity Screenplay e Playwright","permalink":"/pt-BR/docs/screenplay/screenplay_playwright"},"next":{"title":"Fazendo Asser\xe7\xf5es Screenplay com Serenity Ensure","permalink":"/pt-BR/docs/screenplay/screenplay_ensure"}}');var r=s(4848),o=s(8453);const i={id:"screenplay_rest",sidebar_position:3},t="Trabalhando com APIs REST usando Serenity Screenplay",d={},c=[{value:"Configurando seu projeto",id:"configurando-seu-projeto",level:2},{value:"Definindo uma URI base",id:"definindo-uma-uri-base",level:2},{value:"Lendo do arquivo de configuracao do Serenity",id:"lendo-do-arquivo-de-configuracao-do-serenity",level:3},{value:"Definindo a URL da API pela linha de comando",id:"definindo-a-url-da-api-pela-linha-de-comando",level:3},{value:"Configurando a URL base da API no Maven",id:"configurando-a-url-base-da-api-no-maven",level:3},{value:"Configurando o Actor - a Ability CallAnApi",id:"configurando-o-actor---a-ability-callanapi",level:2},{value:"Interaction GET",id:"interaction-get",level:2},{value:"Requisicoes GET simples",id:"requisicoes-get-simples",level:3},{value:"Recuperando objetos",id:"recuperando-objetos",level:3},{value:"Recuperando listas",id:"recuperando-listas",level:3},{value:"Usando Parametros de Caminho",id:"usando-parametros-de-caminho",level:3},{value:"Usando Parametros de Consulta",id:"usando-parametros-de-consulta",level:3},{value:"Consultas Post",id:"consultas-post",level:2},{value:"Outros tipos de consultas",id:"outros-tipos-de-consultas",level:2},{value:"Task de nivel superior",id:"task-de-nivel-superior",level:2}];function l(e){const a={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.header,{children:(0,r.jsx)(a.h1,{id:"trabalhando-com-apis-rest-usando-serenity-screenplay",children:"Trabalhando com APIs REST usando Serenity Screenplay"})}),"\n",(0,r.jsx)(a.p,{children:"O Screenplay Pattern e uma abordagem para escrever testes de aceitacao automatizados que nos ajuda a escrever codigo de automacao mais limpo, mais facil de manter e mais escalavel. Um teste Screenplay fala primeiro e principalmente sobre as Task que um usuario executa, em linguagem de negocios, em vez de mergulhar nos detalhes sobre botoes, cliques e campos de entrada. Focar nas Task de negocios torna nossos testes mais legiveis, mais faceis de manter e mais faceis de escalar."}),"\n",(0,r.jsx)(a.p,{children:'Screenplay e frequentemente associado a testes de UI. Curiosamente, o nome do padrao na verdade nao esta relacionado a telas ou interfaces de usuario; ele vem de uma metafora do teatro, onde Actor desempenham papeis em um palco seguindo um roteiro predefinido (o "screenplay"), e foi cunhado por Antony Marcano e Andy Palmer por volta de 2015. O padrao em si remonta a mais tempo do que isso, e existe em varias formas desde que foi proposto pela primeira vez por Antony Marcano em 2007.'}),"\n",(0,r.jsx)(a.p,{children:"Mas Screenplay tambem e uma otima opcao para testes de API ou servicos web. Em particular, Screenplay e ideal quando queremos incluir atividades de API e UI no mesmo teste. Por exemplo, poderiamos ter uma Task de API para configurar alguns dados de teste, uma Task de UI para ilustrar como um usuario interage com esses dados, e depois outra Task de API para verificar o novo estado do banco de dados."}),"\n",(0,r.jsx)(a.p,{children:"Voce pode ter uma ideia de como sao as interacoes de API REST usando Serenity Screenplay aqui:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'@Test\npublic void list_all_users() {\n\n    Actor sam = Actor.named("Sam the supervisor")\n                     .whoCan(CallAnApi.at(theRestApiBaseUrl));\n\n    sam.attemptsTo(\n            Get.resource("/users")\n    );\n\n    sam.should(\n            seeThatResponse("all the expected users should be returned",\n                    response -> response.statusCode(200)\n                                        .body("data.first_name", hasItems("George", "Janet", "Emma")))\n    );\n}\n'})}),"\n",(0,r.jsxs)(a.p,{children:["Serenity Screenplay usa ",(0,r.jsx)(a.a,{href:"https://rest-assured.io",children:"Rest-Assured"})," para interagir com endpoints REST e consultar as respostas. Rest-Assured nos fornece uma DSL Java simples mas extremamente poderosa que nos permite testar praticamente qualquer tipo de endpoint REST. Seu codigo altamente legivel tambem e uma combinacao ideal para Screenplay."]}),"\n",(0,r.jsx)(a.h2,{id:"configurando-seu-projeto",children:"Configurando seu projeto"}),"\n",(0,r.jsxs)(a.p,{children:["Para testar servicos de API REST com Screenplay, voce precisa adicionar a dependencia ",(0,r.jsx)(a.code,{children:"serenity-screenplay-rest"})," ao seu projeto. No Maven, adicione o seguinte as dependencias no seu arquivo ",(0,r.jsx)(a.code,{children:"pom.xml"}),":"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-xml",children:"<dependency>\n    <groupId>net.serenity-bdd</groupId>\n    <artifactId>serenity-screenplay-rest</artifactId>\n    <version>${serenity.version}</version>\n    <scope>test</scope>\n</dependency>\n"})}),"\n",(0,r.jsxs)(a.p,{children:["E para Gradle, voce pode adicionar a mesma dependencia ao seu arquivo ",(0,r.jsx)(a.code,{children:"build.gradle"}),":"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-groovy",children:'testCompile "net.serenity-bdd:serenity-screenplay-rest:${serenityVersion}"\n'})}),"\n",(0,r.jsx)(a.h2,{id:"definindo-uma-uri-base",children:"Definindo uma URI base"}),"\n",(0,r.jsx)(a.p,{children:"Quando voce testa uma API REST, e conveniente poder usar os mesmos testes contra diferentes ambientes. Voce pode querer executar seus testes contra um servidor rodando na sua maquina local, contra um servidor de QA, ou ate mesmo contra uma maquina de producao. E voce nao quer ter que mudar seus testes sempre que testar contra um ambiente diferente."}),"\n",(0,r.jsxs)(a.p,{children:["Por exemplo, neste capitulo, estaremos demonstrando os recursos do ",(0,r.jsx)(a.code,{children:"serenity-screenplay-rest"})," usando a aplicacao ",(0,r.jsx)(a.a,{href:"https://reqres.in",children:"ResReq"})," (veja abaixo). Se voce tiver uma conexao de internet confiavel, pode executar seus testes contra o servidor ResReq ao vivo em ",(0,r.jsx)(a.a,{href:"https://reqres.in/api/",children:"https://reqres.in/api/"}),". Ou se voce estiver executando o servidor ResReq localmente, acessaria os endpoints em ",(0,r.jsx)(a.a,{href:"http://localhost:5000/api",children:"http://localhost:5000/api"}),"."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.strong,{children:"A aplicacao de teste ResReq"})}),"\n",(0,r.jsxs)(a.p,{children:["A aplicacao ",(0,r.jsx)(a.a,{href:"https://reqres.in",children:"ResReq"})," e uma aplicacao de codigo aberto escrita por ",(0,r.jsx)(a.a,{href:"http://benhowdle.im/",children:"Ben Howdle"})," que facilita experimentar com APIs REST. Ela esta hospedada na Digital Ocean, onde voce pode acessa-la online em ",(0,r.jsx)(a.a,{href:"https://reqres.in/api/",children:"https://reqres.in/api/"}),". Alternativamente, voce tambem pode baixar a aplicacao do ",(0,r.jsx)(a.a,{href:"https://github.com/benhowdle89/reqres",children:"repositorio do projeto no Github"})," e executa-la localmente. Quando voce executa a aplicacao na sua propria maquina, a API REST estara disponivel em ",(0,r.jsx)(a.a,{href:"http://localhost:5000/api",children:"http://localhost:5000/api"}),"."]}),"\n",(0,r.jsx)(a.h3,{id:"lendo-do-arquivo-de-configuracao-do-serenity",children:"Lendo do arquivo de configuracao do Serenity"}),"\n",(0,r.jsxs)(a.p,{children:["No Serenity BDD, voce pode definir a URL base para sua API REST diretamente no arquivo ",(0,r.jsx)(a.code,{children:"serenity.properties"})," ou ",(0,r.jsx)(a.code,{children:"serenity.conf"})," do seu projeto.\nAqui esta um exemplo de um arquivo ",(0,r.jsx)(a.code,{children:"serenity.conf"}),":"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'restapi {\n      baseurl = "https://reqres.in/api"\n}\n'})}),"\n",(0,r.jsxs)(a.p,{children:["Qualquer teste pode ler valores dos arquivos de configuracao do Serenity simplesmente criando um campo do tipo ",(0,r.jsx)(a.code,{children:"EnvironmentVariables"})," no teste.\nVoce pode entao buscar a propriedade e fornecer um valor padrao para usar se a propriedade nao foi definida, como mostrado abaixo:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'theRestApiBaseUrl = environmentVariables.optionalProperty("restapi.baseurl")\n                                        .orElse("https://reqres.in/api");\n'})}),"\n",(0,r.jsx)(a.h3,{id:"definindo-a-url-da-api-pela-linha-de-comando",children:"Definindo a URL da API pela linha de comando"}),"\n",(0,r.jsx)(a.p,{children:"Voce pode sobrescrever a URL padrao definida desta forma simplesmente fornecendo uma propriedade de sistema na linha de comando, assim:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{children:"mvn verify -Drestapi.baseurl=http://localhost:5000/api\n"})}),"\n",(0,r.jsx)(a.h3,{id:"configurando-a-url-base-da-api-no-maven",children:"Configurando a URL base da API no Maven"}),"\n",(0,r.jsxs)(a.p,{children:["Se voce esta usando Maven, uma abordagem mais conveniente pode ser usar ",(0,r.jsx)(a.a,{href:"http://maven.apache.org/guides/introduction/introduction-to-profiles.html",children:"Maven Profiles"}),".\nNo seu arquivo ",(0,r.jsx)(a.code,{children:"pom.xml"}),", voce define diferentes perfis Maven para cada ambiente e configura a propriedade ",(0,r.jsx)(a.code,{children:"restapi.baseurl"})," de acordo:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-xml",children:"<profiles>\n    <profile>\n        <id>dev</id>\n        <properties>\n            <restapi.baseurl>http://localhost:5000/api</restapi.baseurl>\n        </properties>\n    </profile>\n    <profile>\n        <id>prod</id>\n        <properties>\n            <restapi.baseurl>https://reqres.in/api</restapi.baseurl>\n        </properties>\n    </profile>\n</profiles>\n"})}),"\n",(0,r.jsxs)(a.p,{children:["Para que isso funcione corretamente, voce tambem precisa garantir que o ",(0,r.jsx)(a.code,{children:"restapi.baseurl"})," seja passado corretamente para seus testes.\nVoce faz isso usando a tag ",(0,r.jsx)(a.code,{children:"systemPropertyVariables"})," na configuracao do ",(0,r.jsx)(a.code,{children:"maven-failsafe-plugin"}),", como mostrado aqui:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-xml",children:"<build>\n    <plugins>\n        <plugin>\n            <artifactId>maven-failsafe-plugin</artifactId>\n            <version>2.20</version>\n            <configuration>\n                <includes>\n                    <include>**/When*.java</include>\n                    <include>**/*Feature.java</include>\n                </includes>\n                <systemPropertyVariables>\n                    <restapi.baseurl>${restapi.baseurl}</restapi.baseurl>\n                </systemPropertyVariables>\n            </configuration>\n            <executions>\n                <execution>\n                    <goals>\n                        <goal>integration-test</goal>\n                        <goal>verify</goal>\n                    </goals>\n                </execution>\n            </executions>\n        </plugin>\n        ...\n"})}),"\n",(0,r.jsxs)(a.p,{children:["Voce pode entao executar os testes com Maven usando a opcao ",(0,r.jsx)(a.code,{children:"-P"}),":"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{children:"$ mvn verify -Pdev\n"})}),"\n",(0,r.jsx)(a.h2,{id:"configurando-o-actor---a-ability-callanapi",children:"Configurando o Actor - a Ability CallAnApi"}),"\n",(0,r.jsxs)(a.p,{children:["No Screenplay, testes descrevem comportamento em termos de ",(0,r.jsx)(a.em,{children:"Actor"}),", que alcancam seus objetivos de negocios executando ",(0,r.jsx)(a.em,{children:"Task"}),".\nEssas Task geralmente envolvem ",(0,r.jsx)(a.em,{children:"interagir"})," com a aplicacao de alguma forma.\nE para executar essas Task, damos aos Actor varias ",(0,r.jsx)(a.em,{children:"Ability"}),"."]}),"\n",(0,r.jsxs)(a.p,{children:["A Ability ",(0,r.jsx)(a.code,{children:"CallAnApi"})," da aos Actor a habilidade de interagir com um servico web REST usando ",(0,r.jsx)(a.a,{href:"https://rest-assured.io",children:"Rest-Assured"}),".\nIsso inclui tanto invocar endpoints REST quanto consultar os resultados."]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'private String theRestApiBaseUrl;\nprivate EnvironmentVariables environmentVariables;\nprivate Actor sam;\n\n@Before\npublic void configureBaseUrl() {\n    theRestApiBaseUrl = environmentVariables.optionalProperty("restapi.baseurl")\n                                                   .orElse("https://reqres.in/api");\n\n    sam = Actor.named("Sam the supervisor").whoCan(CallAnApi.at(theRestApiBaseUrl));\n}\n'})}),"\n",(0,r.jsxs)(a.p,{children:["A Ability ",(0,r.jsx)(a.code,{children:"CallAnApi"})," permite que o Actor execute as classes de Interaction REST incluidas no Serenity. Estas incluem:"]}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Get.resource()"}),"\n",(0,r.jsx)(a.li,{children:"Post.to()"}),"\n",(0,r.jsx)(a.li,{children:"Put.to()"}),"\n",(0,r.jsx)(a.li,{children:"Delete.from()"}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:["A mais simples delas e ",(0,r.jsx)(a.code,{children:"Get"}),"."]}),"\n",(0,r.jsx)(a.h2,{id:"interaction-get",children:"Interaction GET"}),"\n",(0,r.jsx)(a.p,{children:"Em uma API REST, requisicoes GET sao usadas para consultar um recurso REST.\nVamos ver como podemos fazer isso usando Serenity Screenplay."}),"\n",(0,r.jsx)(a.h3,{id:"requisicoes-get-simples",children:"Requisicoes GET simples"}),"\n",(0,r.jsxs)(a.p,{children:["Em nossa aplicacao de demonstracao, o recurso ",(0,r.jsx)(a.code,{children:"/users"})," representa usuarios da aplicacao.\nPodemos recuperar os detalhes de um usuario especifico anexando o ID do usuario, assim: ",(0,r.jsx)(a.code,{children:"/users/1"}),".\nA estrutura de um registro de usuario e mostrada abaixo:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'{\n  "data": {\n    "id": 1,\n    "first_name": "George",\n    "last_name": "Bluth",\n    "avatar": "https://s3.amazonaws.com/uifaces/faces/twitter/calebogden/128.jpg"\n  }\n}\n'})}),"\n",(0,r.jsx)(a.p,{children:"Suponha que precisamos escrever um Scenario que recupera um usuario especifico e verifica alguns dos detalhes do usuario, como first_name e last_name.\nTal teste poderia ficar assim:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'@Test\npublic void find_an_individual_user() {\n\n    sam.attemptsTo(\n            Get.resource("/users/1")\n    );\n\n    sam.should(\n            seeThatResponse( "User details should be correct",\n                    response -> response.statusCode(200)\n                                        .body("data.first_name", equalTo("George"))\n                                        .body("data.last_name", equalTo("Bluth"))\n            )\n    );\n}\n'})}),"\n",(0,r.jsxs)(a.p,{children:["Como voce pode ver, este codigo e bastante autoexplicativo.\nComo qualquer outro teste Screenplay, usamos o metodo ",(0,r.jsx)(a.code,{children:"attemptsTo()"})," do Actor para executar a acao que queremos testar.\nNeste caso, usamos a classe de Interaction ",(0,r.jsx)(a.code,{children:"Get"}),", que vem incluida com ",(0,r.jsx)(a.code,{children:"serenity-screenplay-rest"}),"."]}),"\n",(0,r.jsxs)(a.p,{children:["Em seguida, verificamos a resposta usando o metodo ",(0,r.jsx)(a.code,{children:"seeThatResponse"}),".\nEste metodo recebe uma expressao Lambda e nos permite acessar a API completa do RestAssured.\nEm particular, podemos usar expressoes ",(0,r.jsx)(a.a,{href:"http://static.javadoc.io/io.restassured/json-path/3.1.0/io/restassured/path/json/JsonPath.html",children:"jsonPath"})," para consultar a estrutura JSON que recebemos."]}),"\n",(0,r.jsx)(a.h3,{id:"recuperando-objetos",children:"Recuperando objetos"}),"\n",(0,r.jsx)(a.p,{children:"As vezes precisamos buscar um valor de uma resposta REST e guarda-lo para uso posterior. RestAssured torna relativamente facil converter uma estrutura JSON em um objeto Java, que voce pode usar mais tarde em seus testes."}),"\n",(0,r.jsx)(a.p,{children:"Por exemplo, suponha que temos uma classe como a abaixo, que corresponde aos detalhes do usuario retornados pelo nosso endpoint:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:"package examples.screenplay.rest.model;\n\npublic class User {\n    private String id;\n    private String first_name;\n    private String last_name;\n\n\n    public User(String first_name, String last_name) {\n        this.first_name = first_name;\n        this.last_name = last_name;\n    }\n\n    public String getId() {\n        return id;\n    }\n\n    public String getFirstName() {\n        return first_name;\n    }\n\n    public String getLastName() {\n        return last_name;\n    }\n}\n"})}),"\n",(0,r.jsxs)(a.p,{children:["Poderiamos recuperar o usuario como uma instancia desta classe chamando o metodo ",(0,r.jsx)(a.code,{children:"jsonPath().getObject()"})," na resposta recebida. Este metodo convertera os dados JSON em um caminho especificado para uma estrutura Java correspondente:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'@Test\npublic void retrieve_an_element_from_the_json_structure() {\n\n    sam.attemptsTo(\n            Get.resource("/users/1")\n    );\n\n    User user = SerenityRest.lastResponse()\n                            .jsonPath()\n                            .getObject("data", User.class);\n\n    assertThat(user.getFirstName()).isEqualTo("George");\n    assertThat(user.getLastName()).isEqualTo("Bluth");\n\n}\n'})}),"\n",(0,r.jsx)(a.h3,{id:"recuperando-listas",children:"Recuperando listas"}),"\n",(0,r.jsx)(a.p,{children:"Frequentemente precisamos recuperar nao um unico item, mas uma lista de itens.\nRecuperar uma lista e pouco diferente de recuperar um unico item:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'sam.attemptsTo(\n        Get.resource("/users")\n);\n\nsam.should(\n        seeThatResponse("all the expected users should be returned",\n                response -> response.body("data.first_name", hasItems("George", "Janet", "Emma")))\n);\n'})}),"\n",(0,r.jsxs)(a.p,{children:["A diferenca acontece quando consultamos os resultados.\nNeste caso, usamos uma expressao jsonPath (",(0,r.jsx)(a.code,{children:"data.first_name"}),") que retornara ",(0,r.jsx)(a.em,{children:"todos"})," os valores do campo first_name.\nO matcher Hamcrest ",(0,r.jsx)(a.code,{children:"hasItems"}),' comparara a colecao de primeiros nomes que a consulta jsonPath retorna e verificara se contem (pelo menos) os nomes "George", "Janet" e "Emma".']}),"\n",(0,r.jsxs)(a.p,{children:["Mas e se quisermos capturar os dados que recuperamos, em vez de simplesmente fazer uma asser\xe7\xe3o sobre o conteudo?\nPodemos fazer isso usando o metodo ",(0,r.jsx)(a.code,{children:"SerenityRest.lastResponse()"}),", assim:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'List<String> userSurnames = SerenityRest.lastResponse().path("data.last_name");\nassertThat(userSurnames).contains("Bluth", "Weaver", "Wong");\n'})}),"\n",(0,r.jsxs)(a.p,{children:["Tambem podemos recuperar listas de objetos, assim como recuperamos uma unica instancia de ",(0,r.jsx)(a.code,{children:"User"})," na secao anterior.\nSimplesmente use o metodo ",(0,r.jsx)(a.code,{children:"jsonPath.getList()"})," como mostrado abaixo:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'sam.attemptsTo(\n        Get.resource("/users")\n);\n\nsam.should(\n        seeThatResponse("all the expected users should be returned",\n                response -> response.body("data.first_name", hasItems("George", "Janet", "Emma")))\n);\n'})}),"\n",(0,r.jsx)(a.h3,{id:"usando-parametros-de-caminho",children:"Usando Parametros de Caminho"}),"\n",(0,r.jsx)(a.p,{children:"No exemplo anterior, codificamos o elemento de caminho na requisicao.\nPara uma abordagem mais flexivel, podemos fornecer o parametro de caminho quando submetemos a consulta:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'sam.attemptsTo(\n        Get.resource("/users/{id}").with( request -> request.pathParam("id", 1))\n);\n'})}),"\n",(0,r.jsxs)(a.p,{children:["Aqui estamos usando a estrutura ",(0,r.jsx)(a.code,{children:"Get.resource(...).with(...)"})," para passar o objeto ",(0,r.jsx)(a.code,{children:"RequestSpecification"})," do RestAssured para uma expressao lambda.\nMais uma vez, isso nos da acesso a toda a riqueza da biblioteca RestAssured."]}),"\n",(0,r.jsx)(a.h3,{id:"usando-parametros-de-consulta",children:"Usando Parametros de Consulta"}),"\n",(0,r.jsxs)(a.p,{children:["Algumas APIs REST recebem parametros de consulta alem de parametros de caminho. Parametros de consulta sao comumente usados para filtrar resultados ou implementar paginacao. Por exemplo, poderiamos obter a segunda pagina de usuarios da nossa API ",(0,r.jsx)(a.code,{children:"/users"})," usando o parametro de consulta ",(0,r.jsx)(a.code,{children:"page"})," assim:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{children:"/users?page=2\n"})}),"\n",(0,r.jsxs)(a.p,{children:["Em nosso codigo de teste, usamos o metodo ",(0,r.jsx)(a.code,{children:"queryParam()"})," para fornecer um valor para o parametro ",(0,r.jsx)(a.code,{children:"page"}),":"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'sam.attemptsTo(\n        Get.resource("/users").with( request -> request.queryParam("page", 2))\n);\n\nsam.should(\n        seeThatResponse("All users on page 2 should be returned",\n                response -> response.body("data.first_name",\n                                     hasItems("Eve", "Charles", "Tracey")))\n);\n'})}),"\n",(0,r.jsx)(a.h2,{id:"consultas-post",children:"Consultas Post"}),"\n",(0,r.jsxs)(a.p,{children:["Podemos enviar requisicoes POST para um endpoint REST usando a classe de Interaction ",(0,r.jsx)(a.code,{children:"Post"}),". Aqui esta um exemplo simples:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'sam.attemptsTo(\n        Post.to("/users")\n                .with(request -> request.header("Content-Type", "application/json")\n                                        .body("{\\"firstName\\": \\"Sarah-Jane\\",\\"lastName\\": \\"Smith\\"}")\n                )\n);\n\nsam.should(\n        seeThatResponse("The user should have been successfully added",\n                        response -> response.statusCode(201))\n);\n'})}),"\n",(0,r.jsx)(a.p,{children:"Alternativamente, podemos postar um objeto, deixando o RestAssured converter os campos do objeto em JSON para nos:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'User newUser = new User("Sarah-Jane", "Smith");\n\nsam.attemptsTo(\n        Post.to("/users")\n                .with(request -> request.header("Content-Type", "application/json")\n                                        .body(newUser)\n                )\n);\n'})}),"\n",(0,r.jsx)(a.h2,{id:"outros-tipos-de-consultas",children:"Outros tipos de consultas"}),"\n",(0,r.jsxs)(a.p,{children:["Outros tipos de consulta sao semelhantes as consultas ",(0,r.jsx)(a.code,{children:"GET"})," e ",(0,r.jsx)(a.code,{children:"POST"}),".\nPor exemplo, requisicoes ",(0,r.jsx)(a.code,{children:"PUT"})," sao frequentemente usadas para atualizar recursos.\nNo exemplo a seguir, usamos uma requisicao ",(0,r.jsx)(a.code,{children:"PUT"})," para atualizar os detalhes de um usuario:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'sam.attemptsTo(\n        Put.to("/users")\n                .with(request -> request.header("Content-Type", "application/json")\n                        .body("{\\"firstName\\": \\"jack\\",\\"lastName\\": \\"smith\\"}")\n                )\n);\n\nsam.should(\n        seeThatResponse(response -> response.statusCode(200)\n                                            .body("updatedAt", not(isEmptyString())))\n);\n'})}),"\n",(0,r.jsxs)(a.p,{children:["Ou voce pode excluir um usuario usando a consulta ",(0,r.jsx)(a.code,{children:"DELETE"})," como mostrado aqui:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'sam.attemptsTo(\n        Delete.from("/users/1")\n);\n\nsam.should(\n        seeThatResponse(response -> response.statusCode(204))\n);\n'})}),"\n",(0,r.jsx)(a.h2,{id:"task-de-nivel-superior",children:"Task de nivel superior"}),"\n",(0,r.jsx)(a.p,{children:"As Interaction que vimos ate agora sao legiveis, mas ainda sao de nivel bastante baixo.\nScreenplay nos permite construir Task de nivel superior que representam a intencao de negocios por tras dessas Interaction."}),"\n",(0,r.jsx)(a.p,{children:"Por exemplo, voce poderia definir uma Task que encapsula listar todos os usuarios assim:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'package examples.screenplay.rest.tasks;\n\nimport net.serenitybdd.screenplay.Task;\nimport net.serenitybdd.screenplay.rest.interactions.Get;\n\npublic class UserTasks {\n    public static Task listAllUsers() {\n        return Task.where("{0} lists all users",\n                Get.resource("/users")\n        );\n    }\n}\n'})}),"\n",(0,r.jsx)(a.p,{children:"Podemos entao usar um import estatico para refatorar nosso primeiro teste da seguinte forma:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:"sam.attemptsTo(\n        listAllUsers()\n);\n"})}),"\n",(0,r.jsxs)(a.p,{children:["Para um pouco mais de flexibilidade, tambem podemos escrever uma classe ",(0,r.jsx)(a.code,{children:"Task"})," customizada. Por exemplo, poderiamos escrever uma Task ",(0,r.jsx)(a.code,{children:"FindAUser"})," para encontrar um usuario por ID:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:'package examples.screenplay.rest.tasks;\n\nimport net.serenitybdd.screenplay.Actor;\nimport net.serenitybdd.screenplay.Task;\nimport net.serenitybdd.screenplay.rest.interactions.Get;\nimport net.thucydides.core.annotations.Step;\n\nimport static net.serenitybdd.screenplay.Tasks.instrumented;\n\npublic class FindAUser implements Task{\n    private final int id;\n\n    public FindAUser(int id) {\n        this.id = id;\n    }\n\n    public static FindAUser withId(int id) {\n        return instrumented(FindAUser.class, id);\n    }\n\n    @Override\n    @Step("{0} fetches the user with id #id")\n    public <T extends Actor> void performAs(T actor) {\n        actor.attemptsTo(\n                Get.resource("/users/{id}")\n                   .with(request -> request.pathParam("id", id))\n        );\n    }\n}\n'})}),"\n",(0,r.jsx)(a.p,{children:"Usando esta classe, poderiamos refatorar nossa classe original para ler assim:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-java",children:"sam.attemptsTo(\n        FindAUser.withId(1)\n);\n"})}),"\n",(0,r.jsx)(a.p,{children:"Usar Task para encapsular Interaction REST resulta em uma estrutura de relatorio clara e em camadas, que primeiro descreve o que o usuario esta fazendo e depois como ele faz isso. O relatorio de teste para o Scenario anterior e mostrado aqui:"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{src:s(886).A+"",width:"1770",height:"744"})})]})}function u(e={}){const{wrapper:a}={...(0,o.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453(e,a,s){s.d(a,{R:()=>i,x:()=>t});var n=s(6540);const r={},o=n.createContext(r);function i(e){const a=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(o.Provider,{value:a},e.children)}}}]);